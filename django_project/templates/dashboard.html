{%extends 'base.html'%}

{%block title%}Dashboard{%endblock%}

{%block navbar%}
{%include 'navbar.html'%}
{%endblock%}

{%block content%}
<h1 class="text-center">Dashboard</h1>
<div class="row mt-5">
    {%for playlist in playlist_list%}
    <div class="col-md-3">
        <a href="{%url 'detail_playlist' playlist.pk%}" style="text-decoration:none; color:black">
            <div class="card" style="height:130px">
                <div class="card-body">
                    <h5 class="card-title text-center">{{playlist.title}}</h5>
                    <p class="card-text text-center">{{playlist.created}}</p>
                    {% if playlist.title != "My Favourite" %}
                    <div class="d-flex align-items-center justify-content-center">
                        <a id="share" href="#"
                           onclick="shareToCopy(this, {{playlist.pk}})"
                           class="share card-link">Share</a>
                        <p class="copied" id="{{playlist.pk}}" style="display:none;">Copied</p>
                    </div>
                    {%endif%}
                </div>
            </div>
        </a>
    </div>
    {%endfor%}
</div>

<h2 class="text-center mt-5">Recommendation</h2>

<div class="mt-3 d-flex"
     style="width:1000px; overflow-x:auto; white-space:nowrap; border-left: 1px solid rgba(0,0,0,0.3); border-right: 1px solid rgba(0,0,0,0.3);">
    {%for recommended_song in recommended_list%}
    <div class="mx-3" style="min-width:25%;">
        <a href="{% url 'song' recommended_song.song.pk%}" style="text-decoration:none">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">{{recommended_song.song.title}}</h6>
                    <p class="card-text">{{recommended_song.song.author}}</p>
                </div>
            </div>
        </a>
    </div>
    {%endfor%}
</div>

<script>
    function shareToCopy(e, id){
        navigator.clipboard.writeText('{{request.build_absolute_uri}}shared_playlist/'+id);
        document.querySelectorAll('.copied').forEach(copied=>{
            copied.style.display='none';
            document.querySelectorAll('.share').forEach(share=>{
                share.style.display='block';
            })
        })
        e.style.display='none';
        document.getElementById(`${id}`).style.display='block';
    }
</script>
{%endblock%}

{%load static%}
{%block script%}<script src="{%static 'js/script.js'%}"></script>{%endblock%}